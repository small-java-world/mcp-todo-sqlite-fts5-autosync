# FTS 検索の安全設計

## ポリシー

- 演算子の許可リスト（WL）: AND/OR/NEAR/"exact" のみ許可
- サニタイズ: 制御文字/ワイルドカードの連続は無効化
- クォータ制限: max tokens, max length, timeout(ms)

## 実装の要点

- クエリ正規化: 空白正規化、引用符の対応
- 例外の安全化: ユーザ入力由来のエラーは 400 にマッピング
- snippet の長さ上限、ハイライト最小化

## テスト

- 無害化ケース（*, \, 未対応演算子）
- 長大入力/無限パターンの打ち切り
- レイテンシ上限の監視
